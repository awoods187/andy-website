---
/**
 * Post Card Component
 *
 * Displays a blog post card with image, title, date, and excerpt.
 * Supports both internal posts and external posts (e.g., Cockroach Labs blog).
 * Design inspired by tomtunguz.com with horizontal layout.
 *
 * @param title - Post title
 * @param date - Publication date as Date object or string
 * @param excerpt - Brief summary text
 * @param slug - URL slug for internal posts
 * @param url - Full URL for external posts
 * @param image - Featured image URL (optional)
 * @param tags - Array of tag strings
 * @param source - Source identifier ('personal' or 'cockroach-labs')
 */

interface Props {
  title: string;
  date: Date | string;
  excerpt: string;
  slug?: string;
  url?: string;
  image?: string | null;
  tags: string[];
  source?: 'personal' | 'cockroach-labs' | 'publications';
}

const { title, date, excerpt, slug, url, image, tags, source = 'personal' } = Astro.props;

// Determine the post URL
const postUrl = url || `/blog/${slug}`;
const isExternal = !!url;

// Format date
// Use UTC timezone to ensure dates match the frontmatter (avoids timezone conversion issues)
const dateObj = typeof date === 'string' ? new Date(date) : date;
const formattedDate = new Intl.DateTimeFormat('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
  timeZone: 'UTC'
}).format(dateObj);

// Default placeholder image if none provided
const imageUrl = image || '/images/default-post.svg';

// Source badge text
const sourceBadge =
  source === 'cockroach-labs' ? 'Cockroach Labs' :
  source === 'publications' ? 'Publication' :
  null;
---

<article class="mb-8 pb-8 border-b border-gray-200 last:border-b-0">
  <a
    href={postUrl}
    class="flex gap-6 no-underline hover:opacity-90 transition-opacity group"
    target={isExternal ? '_blank' : undefined}
    rel={isExternal ? 'noopener noreferrer' : undefined}
  >
    {/* Post Image - always show with placeholder if none provided */}
    <div class="flex-shrink-0 w-48 h-32 overflow-hidden rounded-lg bg-gray-100">
      <img
        src={imageUrl}
        alt={title}
        class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
        loading="lazy"
      />
    </div>

    {/* Post Content */}
    <div class="flex-1 min-w-0">
      {/* Title with source badge */}
      <h2 class="font-sans text-xl font-semibold mb-2 text-black">
        {title}
        {sourceBadge && (
          <span class="ml-2 text-xs font-normal text-gray-500 border border-gray-300 px-2 py-0.5 rounded">
            {sourceBadge}
          </span>
        )}
      </h2>

      {/* Date */}
      <time datetime={dateObj.toISOString()} class="text-sm text-gray-500 block mb-2">
        {formattedDate}
      </time>

      {/* Excerpt */}
      <p class="text-base leading-relaxed text-gray-700 mb-3 line-clamp-2">
        {excerpt}
      </p>

      {/* Tags */}
      {tags.length > 0 && (
        <div class="flex gap-2 flex-wrap">
          {tags.slice(0, 4).map(tag => (
            <span class="text-xs px-2 py-1 bg-gray-100 text-gray-700 rounded">
              {tag}
            </span>
          ))}
        </div>
      )}
    </div>
  </a>
</article>

<style>
  /* Line clamp utility for excerpt truncation */
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
